<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FlashDoc Preferences</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <main class="options-container">
    <header class="options-header">
      <div class="options-title">
        <span class="logo">‚ö°</span>
        <div>
          <h1>FlashDoc Preferences</h1>
          <p class="subtitle">Customize how FlashDoc saves behave everywhere.</p>
        </div>
      </div>
      <div class="version" id="extension-version"></div>
    </header>

    <form id="options-form">
      <section class="options-card">
        <h2>Storage</h2>
        <div class="field">
          <label for="folderPath">Default folder</label>
          <input id="folderPath" name="folderPath" type="text" placeholder="FlashDocs/">
          <p class="help">Relative to your default Downloads directory.</p>
        </div>
        <div class="field">
          <label for="namingPattern">Naming pattern</label>
          <select id="namingPattern" name="namingPattern">
            <option value="timestamp">Timestamp &mdash; <code>flashdoc_YYYY-MM-DD</code></option>
            <option value="firstline">First line of selection</option>
            <option value="custom">Custom template</option>
          </select>
        </div>
        <div class="field hidden" id="custom-pattern-row">
          <label for="customPattern">Custom filename template</label>
          <input id="customPattern" name="customPattern" type="text" placeholder="file_{date}_{type}">
          <p class="help">Available tokens: <code>{date}</code>, <code>{time}</code>, <code>{type}</code></p>
        </div>

        <!-- Live Filename Preview -->
        <div class="field" id="filename-preview-row">
          <label>Live Preview</label>
          <div class="filename-preview" id="filename-preview">
            <span class="preview-folder" id="preview-folder">FlashDocs/</span>
            <span class="preview-filename" id="preview-filename">flashdoc_2026-01-05_1423</span>
            <span class="preview-ext" id="preview-ext">.md</span>
          </div>
          <p class="help">This is how your next file will be named (format depends on content type)</p>
        </div>

        <div class="toggle">
          <label for="organizeByType">Organize by format</label>
          <label class="switch">
            <input id="organizeByType" name="organizeByType" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <section class="options-card">
        <h2>Capture intelligence</h2>
        <div class="toggle">
          <label for="autoDetectType">Smart format detection</label>
          <label class="switch">
            <input id="autoDetectType" name="autoDetectType" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="toggle">
          <label for="enableSmartDetection">Highlight detected type in page</label>
          <label class="switch">
            <input id="enableSmartDetection" name="enableSmartDetection" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="field">
          <label for="selectionThreshold">Minimum selection length</label>
          <div class="range-field">
            <input id="selectionThreshold" name="selectionThreshold" type="range" min="0" max="200" step="5">
            <span class="range-value"><span id="selectionThresholdValue">0</span> characters</span>
          </div>
        </div>
      </section>

      <section class="options-card">
        <h2>Privacy</h2>
        <div class="toggle">
          <label for="privacyMode">Privacy mode (on-demand injection)</label>
          <label class="switch">
            <input id="privacyMode" name="privacyMode" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <p class="help privacy-help">When enabled, FlashDoc only activates when you click the extension icon or use a keyboard shortcut. No scripts run on pages until you explicitly activate them.</p>
        <div class="privacy-status" id="privacy-status"></div>
      </section>

      <section class="options-card">
        <h2>Interface</h2>
        <div class="toggle">
          <label for="showFloatingButton">Floating quick-save button</label>
          <label class="switch">
            <input id="showFloatingButton" name="showFloatingButton" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="field" id="button-position-row">
          <label for="buttonPosition">Button position</label>
          <select id="buttonPosition" name="buttonPosition">
            <option value="bottom-right">Bottom right</option>
            <option value="bottom-left">Bottom left</option>
            <option value="top-right">Top right</option>
            <option value="top-left">Top left</option>
          </select>
        </div>
        <div class="toggle">
          <label for="autoHideButton">Auto-hide when idle</label>
          <label class="switch">
            <input id="autoHideButton" name="autoHideButton" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="toggle">
          <label for="enableContextMenu">Context menu integration</label>
          <label class="switch">
            <input id="enableContextMenu" name="enableContextMenu" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <section class="options-card">
        <h2>Context menu formats</h2>
        <p class="help">Choose which formats appear when you right-click selected text.</p>
        <div class="format-grid" id="context-menu-formats"></div>
      </section>

      <!-- v3.1: Contextual Chip Slots Section -->
      <section class="options-card">
        <h2>Contextual Chip Slots</h2>
        <p class="help">Configure the 5 action buttons that appear when you select text.</p>

        <!-- Visual Preview of Floating Button -->
        <div class="slot-preview-container">
          <div class="slot-preview-chip">
            <div class="preview-save-bar">
              <span class="preview-logo">‚ö°</span>
              <span class="preview-save-text">Save</span>
              <span class="preview-type-badge">TXT <span class="preview-dropdown-arrow">‚ñº</span></span>
            </div>
            <div class="preview-slot-buttons" id="preview-slot-buttons">
              <div class="preview-slot" data-slot="0">üìÑ</div>
              <div class="preview-slot" data-slot="1">üìù</div>
              <div class="preview-slot" data-slot="2">üìú</div>
              <div class="preview-slot" data-slot="3">üìï</div>
              <div class="preview-slot" data-slot="4">üìÅ</div>
            </div>
          </div>
          <!-- Slot Dropdowns directly below each button -->
          <div class="slot-dropdowns-row" id="slots-config">
            <!-- Dynamically populated by options.js -->
          </div>
        </div>

        <!-- Preset Management -->
        <div class="preset-section">
          <h3>Slot Presets</h3>
          <p class="help preset-help">Speichere Slot-Konfigurationen als Presets und wechsle schnell zwischen ihnen.</p>

          <!-- Active Preset Indicator -->
          <div class="active-preset-indicator" id="active-preset-indicator">
            <span class="indicator-label">Aktiv:</span>
            <span class="indicator-name" id="active-preset-name">Keins</span>
          </div>

          <div class="preset-toolbar">
            <select id="preset-selector" class="preset-select">
              <option value="">‚Äî Preset w√§hlen ‚Äî</option>
            </select>
            <button type="button" class="btn primary small" id="preset-apply" title="Ausgew√§hltes Preset aktivieren">Anwenden</button>
          </div>

          <div class="preset-actions">
            <button type="button" class="btn secondary small" id="preset-new" title="Neues Preset aus aktuellen Slots erstellen">+ Neu</button>
            <button type="button" class="btn secondary small" id="preset-save" title="Aktuelle Slots im ausgew√§hlten Preset speichern">Speichern</button>
            <button type="button" class="btn danger small" id="preset-delete" title="Ausgew√§hltes Preset l√∂schen">L√∂schen</button>
          </div>

          <span class="preset-count" id="preset-count">0/5 Presets</span>
        </div>
      </section>

      <!-- Category Shortcuts Section -->
      <section class="options-card">
        <h2>Prefix Shortcuts</h2>
        <p class="help">Erstelle Schnellspeicher-Kombinationen. Beispiel: "Design" + ".md" = speichert als "Design_save.md"</p>

        <!-- Add new shortcut form -->
        <div class="shortcut-add-form">
          <input type="text" id="new-shortcut-name" placeholder="Prefix eingeben (z.B. Design)" maxlength="20">
          <select id="new-shortcut-format">
            <option value="md">.md</option>
            <option value="txt">.txt</option>
            <option value="docx">.docx</option>
            <option value="pdf">.pdf</option>
            <option value="json">.json</option>
            <option value="js">.js</option>
            <option value="py">.py</option>
            <option value="html">.html</option>
            <option value="css">.css</option>
            <option value="yaml">.yaml</option>
          </select>
          <button type="button" class="btn primary small" id="add-shortcut">Hinzuf√ºgen</button>
        </div>

        <!-- Existing shortcuts list -->
        <div class="shortcut-list" id="shortcut-list"></div>
        <div class="shortcut-footer">
          <span class="shortcut-count" id="shortcut-count">0/10 Shortcuts</span>
        </div>
      </section>

      <!-- F3: Corner Ball Section -->
      <section class="options-card">
        <h2>Corner Ball</h2>
        <p class="help">The FlashDoc ball appears in the corner and can be dragged out of the way.</p>
        <div class="toggle">
          <label for="showCornerBall">Show corner ball</label>
          <label class="switch">
            <input id="showCornerBall" name="showCornerBall" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <section class="options-card">
        <h2>Feedback</h2>
        <div class="toggle">
          <label for="showNotifications">Show notifications</label>
          <label class="switch">
            <input id="showNotifications" name="showNotifications" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
        <div class="toggle">
          <label for="playSound">Play confirmation sound</label>
          <label class="switch">
            <input id="playSound" name="playSound" type="checkbox">
            <span class="slider"></span>
          </label>
        </div>
      </section>

      <section class="options-card">
        <h2>Event Tracking & Recommendations</h2>
        <p class="help">Track key events and get format recommendations based on your usage patterns</p>

        <div class="toggle">
          <label for="trackFormatUsage">Track format usage statistics</label>
          <label class="switch">
            <input id="trackFormatUsage" name="trackFormatUsage" type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle">
          <label for="trackDetectionAccuracy">Track auto-detection accuracy</label>
          <label class="switch">
            <input id="trackDetectionAccuracy" name="trackDetectionAccuracy" type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </div>

        <div class="toggle">
          <label for="showFormatRecommendations">Show format recommendations</label>
          <label class="switch">
            <input id="showFormatRecommendations" name="showFormatRecommendations" type="checkbox" checked>
            <span class="slider"></span>
          </label>
        </div>

        <div class="recommendations-panel" id="recommendations-panel">
          <h3>Available Recommendations</h3>
          <div class="recommendations-list" id="recommendations-list">
            <div class="recommendation-item">
              <span class="rec-icon">üí°</span>
              <div class="rec-content">
                <strong>Loading recommendations...</strong>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="options-actions">
        <div class="status" id="status-message" role="status" aria-live="polite"></div>
        <div class="buttons">
          <button type="button" class="btn secondary" id="reset-defaults">Reset defaults</button>
          <button type="submit" class="btn primary">Save changes</button>
        </div>
      </section>
    </form>
  </main>

  <script src="options.js"></script>
</body>
</html>
